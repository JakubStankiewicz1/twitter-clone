<div class="messages-container">
  <div class="conversations-list">
    <div class="conv-header">Messages</div>
    <div *ngIf="loading" class="loader">Loading...</div>
    <div *ngFor="let conv of conversations" class="conversation" [class.active]="selectedUser?.id === conv.user.id" (click)="selectConversation(conv.user)">
      <div class="avatar">{{ conv.user.displayName ? conv.user.displayName.charAt(0).toUpperCase() : conv.user.username.charAt(0).toUpperCase() }}</div>
      <div class="conv-info">
        <div class="conv-name">{{ conv.user.displayName || conv.user.username }}</div>
        <div class="conv-last">{{ conv.lastMessage.content }}</div>
      </div>
      <div class="conv-date">{{ conv.lastMessage.createdAt | date:'short' }}</div>
    </div>
    <div *ngIf="!loading && conversations.length === 0" class="empty">No conversations</div>
  </div>
  <div class="chat-window" *ngIf="selectedUser">
    <div class="chat-header">
      <div class="avatar">{{ selectedUser.displayName ? selectedUser.displayName.charAt(0).toUpperCase() : selectedUser.username.charAt(0).toUpperCase() }}</div>
      <div class="chat-user-info">
        <div class="chat-name">{{ selectedUser.displayName || selectedUser.username }}</div>
        <div class="chat-username">{{'@' + selectedUser.username}}</div>
      </div>
    </div>
    <div class="chat-messages">
      <div *ngFor="let msg of messages" class="chat-message" [class.me]="msg.sender.id === currentUser?.id">
        <div class="msg-content">{{ msg.content }}</div>
        <div class="msg-date">{{ msg.createdAt | date:'shortTime' }}</div>
      </div>
    </div>
    <form class="chat-input" (ngSubmit)="sendMessage()">
      <input [(ngModel)]="newMessage" name="newMessage" placeholder="Type a message..." autocomplete="off" />
      <button type="submit" [disabled]="!newMessage.trim()">Send</button>
    </form>
  </div>
  <div class="chat-placeholder" *ngIf="!selectedUser">
    <span>Select a conversation</span>
  </div>
</div> 